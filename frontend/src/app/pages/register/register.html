<main class="auth-wrapper with-header">
  <div class="container">
    <div class="auth-card card glass">
      <div class="auth-left">
        <h1>Cr√©er un compte</h1>
        <p class="muted">Inscrivez-vous en tant que <strong>Client</strong> ou <strong>Agent</strong>.</p>

        <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
          <!-- R√¥le -->
          <div class="field">
            <span>Je suis</span>
            <div class="roles">
              <label class="chip" [class.selected]="role?.value === 'CLIENT'">
                <input type="radio" formControlName="role" value="CLIENT" />
                Client
              </label>
              <label class="chip" [class.selected]="role?.value === 'AGENT'">
                <input type="radio" formControlName="role" value="AGENT" />
                Agent
              </label>
            </div>
            <small class="error" *ngIf="role?.touched && role?.invalid">Choisissez un r√¥le.</small>
          </div>

          <!-- Nom -->
          <label class="field">
            <span>Nom</span>
            <input type="text" formControlName="nom" placeholder="Dupont"
                   [class.invalid]="nom?.touched && nom?.invalid" />
            <small class="error" *ngIf="nom?.touched && nom?.invalid">Requis (min. 2 caract√®res).</small>
          </label>

          <!-- Pr√©nom -->
          <label class="field">
            <span>Pr√©nom</span>
            <input type="text" formControlName="prenom" placeholder="Amine"
                   [class.invalid]="prenom?.touched && prenom?.invalid" />
            <small class="error" *ngIf="prenom?.touched && prenom?.invalid">Requis (min. 2 caract√®res).</small>
          </label>

          <!-- Num√©ro CIN -->
          <label class="field">
            <span>Num√©ro CIN</span>
            <input type="text" formControlName="numCin" placeholder="12345678"
                   maxlength="8"
                   [class.invalid]="numCin?.touched && numCin?.invalid" />
            <small class="error" *ngIf="numCin?.touched && numCin?.hasError('required')">
              Num√©ro CIN requis.
            </small>
            <small class="error" *ngIf="numCin?.touched && numCin?.hasError('pattern')">
              Le CIN doit contenir exactement 8 chiffres.
            </small>
          </label>

          <!-- Num√©ro compte bancaire (CONDITIONNEL - Seulement pour CLIENT) -->
          <label class="field" *ngIf="role?.value === 'CLIENT'">
            <span>Num√©ro de compte bancaire</span>
            <input type="text" formControlName="numCompteBancaire" placeholder="1234567890123456"
                   maxlength="20"
                   [class.invalid]="numCompteBancaire?.touched && numCompteBancaire?.invalid" />
            <small class="error" *ngIf="numCompteBancaire?.touched && numCompteBancaire?.hasError('required')">
              Num√©ro de compte bancaire requis.
            </small>
            <small class="error" *ngIf="numCompteBancaire?.touched && numCompteBancaire?.hasError('pattern')">
              Le num√©ro de compte doit contenir entre 10 et 20 chiffres.
            </small>
          </label>

          <!-- Email -->
          <label class="field">
            <span>Email</span>
            <input type="email" formControlName="email" autocomplete="email"
                   placeholder="amine.dupont@email.tn"
                   [class.invalid]="email?.touched && email?.invalid" />
            <small class="error" *ngIf="email?.touched && email?.hasError('required')">
              Email requis.
            </small>
            <small class="error" *ngIf="email?.touched && email?.hasError('email')">
              Format d'adresse email invalide.
            </small>
          </label>

          <!-- Mot de passe -->
          <div class="field">
            <span>Mot de passe</span>
            <div class="password-wrap">
              <input [type]="hide ? 'password' : 'text'"
                     formControlName="password"
                     placeholder="Mot de passe"
                     autocomplete="new-password"
                     [class.invalid]="password?.touched && password?.invalid" />
              <button type="button" class="toggle"
                      (click)="hide = !hide"
                      aria-label="Afficher/Masquer le mot de passe">
                {{ hide ? 'üôà' : 'üëÅÔ∏è' }}
              </button>
            </div>
            <small class="muted">Au moins 8 caract√®res, 1 maj, 1 min, 1 chiffre, 1 sp√©cial.</small>
            <small class="error" *ngIf="password?.touched && password?.hasError('required')">
              Mot de passe requis.
            </small>
            <small class="error" *ngIf="password?.touched && password?.hasError('minlength')">
              Au moins 8 caract√®res.
            </small>
            <small class="error" *ngIf="password?.touched && password?.hasError('pattern')">
              Doit contenir une majuscule, une minuscule, un chiffre et un caract√®re sp√©cial.
            </small>
          </div>

          <!-- Confirmation mot de passe -->
          <div class="field">
            <span>Confirmer le mot de passe</span>
            <div class="password-wrap">
              <input
                [type]="hideConfirm ? 'password' : 'text'"
                formControlName="confirmPassword"
                placeholder="Confirmer le mot de passe"
                [class.invalid]="
                  (confirmPassword?.touched && confirmPassword?.invalid) ||
                  (confirmPassword?.touched && form.errors?.['passwordMismatch'])
                "
              />
              <button type="button" class="toggle"
                      (click)="hideConfirm = !hideConfirm"
                      aria-label="Afficher/Masquer le mot de passe confirm√©">
                {{ hideConfirm ? 'üôà' : 'üëÅÔ∏è' }}
              </button>
            </div>
            <small class="error" *ngIf="confirmPassword?.touched && confirmPassword?.hasError('required')">
              Confirmez votre mot de passe.
            </small>
            <small class="error" *ngIf="confirmPassword?.touched && form.errors?.['passwordMismatch']">
              Les mots de passe ne correspondent pas.
            </small>
          </div>

          <!-- Erreur serveur -->
          <div class="server-error" *ngIf="serverError">{{ serverError }}</div>

          <!-- Actions -->
          <button class="btn btn-primary full" type="submit" [disabled]="loading">
            {{ loading ? 'Cr√©ation‚Ä¶' : 'Cr√©er un compte' }}
          </button>

          <p class="muted center small">
            D√©j√† inscrit ? <a class="link" [routerLink]="['/login']">Se connecter</a>
          </p>
        </form>
      </div>
    </div>
  </div>
</main>