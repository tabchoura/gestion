<main class="auth-wrapper with-header">
  <div class="container">
    <div class="auth-card card glass">
      <div class="auth-left">
        <h1>CrÃ©er un compte</h1>
        <p class="muted">Inscrivez-vous en tant que <strong>Client</strong> ou <strong>Agent</strong>.</p>

        <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
          <!-- RÃ´le -->
          <div class="field">
            <span>Je suis</span>
            <div class="roles">
              <label class="chip" [class.selected]="role?.value === 'CLIENT'">
                <input type="radio" formControlName="role" value="CLIENT" />
                Client
              </label>
              <label class="chip" [class.selected]="role?.value === 'AGENT'">
                <input type="radio" formControlName="role" value="AGENT" />
                Agent
              </label>
            </div>
            <small class="error" *ngIf="role?.touched && role?.invalid">Choisissez un rÃ´le.</small>
          </div>

          <!-- Nom -->
          <label class="field">
            <span>Nom</span>
            <input type="text" formControlName="nom" placeholder="Dupont"
                   [class.invalid]="nom?.touched && nom?.invalid" />
            <small class="error" *ngIf="nom?.touched && nom?.invalid">Requis (min. 2 caractÃ¨res).</small>
          </label>

          <!-- PrÃ©nom -->
          <label class="field">
            <span>PrÃ©nom</span>
            <input type="text" formControlName="prenom" placeholder="Amine"
                   [class.invalid]="prenom?.touched && prenom?.invalid" />
            <small class="error" *ngIf="prenom?.touched && prenom?.invalid">Requis (min. 2 caractÃ¨res).</small>
          </label>

          <!-- Email -->
          <label class="field">
            <span>Email</span>
            <input type="email" formControlName="email" autocomplete="email"
                   placeholder="amine.dupont@email.tn"
                   [class.invalid]="email?.touched && email?.invalid" />
            <small class="error" *ngIf="email?.touched && email?.hasError('required')">
              Email requis.
            </small>
            <small class="error" *ngIf="email?.touched && email?.hasError('email')">
              Format dâ€™adresse email invalide.
            </small>
          </label>

          <!-- Mot de passe -->
          <div class="field">
            <span>Mot de passe</span>
            <div class="password-wrap">
              <input [type]="hide ? 'password' : 'text'"
                     formControlName="password"
                     placeholder="Mot de passe"
                     autocomplete="new-password"
                     [class.invalid]="password?.touched && password?.invalid" />
              <button type="button" class="toggle"
                      (click)="hide = !hide"
                      aria-label="Afficher/Masquer le mot de passe">
                {{ hide ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>
            <small class="muted">Au moins 8 caractÃ¨res, 1 maj, 1 min, 1 chiffre, 1 spÃ©cial.</small>
            <small class="error" *ngIf="password?.touched && password?.hasError('required')">
              Mot de passe requis.
            </small>
            <small class="error" *ngIf="password?.touched && password?.hasError('minlength')">
              Au moins 8 caractÃ¨res.
            </small>
            <small class="error" *ngIf="password?.touched && password?.hasError('pattern')">
              Doit contenir une majuscule, une minuscule, un chiffre et un caractÃ¨re spÃ©cial.
            </small>
          </div>

          <!-- Confirmation mot de passe -->
          <div class="field">
            <span>Confirmer le mot de passe</span>
            <div class="password-wrap">
              <input
                [type]="hideConfirm ? 'password' : 'text'"
                formControlName="confirmPassword"
                placeholder="Confirmer le mot de passe"
                [class.invalid]="
                  (confirmPassword?.touched && confirmPassword?.invalid) ||
                  (confirmPassword?.touched && form.errors?.['passwordMismatch'])
                "
              />
              <button type="button" class="toggle"
                      (click)="hideConfirm = !hideConfirm"
                      aria-label="Afficher/Masquer le mot de passe confirmÃ©">
                {{ hideConfirm ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>
            <small class="error" *ngIf="confirmPassword?.touched && confirmPassword?.hasError('required')">
              Confirmez votre mot de passe.
            </small>
            <small class="error" *ngIf="confirmPassword?.touched && form.errors?.['passwordMismatch']">
              Les mots de passe ne correspondent pas.
            </small>
          </div>

          <!-- Erreur serveur -->
          <div class="server-error" *ngIf="serverError">{{ serverError }}</div>

          <!-- Actions -->
          <button class="btn btn-primary full" type="submit" [disabled]="loading">
            {{ loading ? 'CrÃ©ationâ€¦' : 'CrÃ©er un compte' }}
          </button>

          <p class="muted center small">
            DÃ©jÃ  inscrit ? <a class="link" [routerLink]="['/login']">Se connecter</a>
          </p>
        </form>
      </div>
    </div>
  </div>
</main>
