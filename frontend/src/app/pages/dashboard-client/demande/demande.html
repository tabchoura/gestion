<!-- En-tête -->
<div class="card header">
  <div class="title">
    <i class="ri-booklet-line"></i>
    Mes Demandes de Chéquier
  </div>
  <button class="btn light" routerLink="/dashboardclient/comptes">
    <i class="ri-arrow-left-line"></i> Retour aux Comptes
  </button>
</div>

<!-- Liste + Actions (création directe) -->
<div class="card list">
  <div class="list-header">
    <div class="title small">
      <!-- infos compte si besoin -->
      <!-- <ng-container *ngIf="selectedCompte">
        — <b>{{ selectedCompte.banque }} — {{ selectedCompte.numeroCompte }} ({{ selectedCompte.devise || '—' }})</b>
      </ng-container> -->
    </div>
    <button class="btn success" (click)="openModal()" [disabled]="!compteIdSel()">
      <i class="ri-add-line"></i> Nouvelle Demande
    </button>
  </div>

  <table class="table" *ngIf="demandes?.length; else empty">
    <thead>
      <tr>
        <th>Date Demande</th>
        <th>Pages</th>
        <th>Motif</th>
        <th>Statut</th>
        <th class="actions">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let d of demandes">
        <td>{{ d.dateDemande | date:'dd/MM/yyyy' }}</td>
        <td>{{ d.pages }}</td>
        <td>{{ d.motif || '—' }}</td>
        <td><span [class]="badgeClass(d.statut)">{{ d.statut.replace('_',' ') }}</span></td>
        <td class="actions">
      <button class="icon blue" title="Modifier" (click)="modifier(d)">
  <i class="ri-edit-2-line">✏</i>
</button>

<button class="icon dark" title="Annuler" *ngIf="d.statut==='EN_ATTENTE'" (click)="annuler(d)">
  <i class="ri-close-circle-line">❌</i>
</button>


        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #empty>
    <div class="empty" *ngIf="compteIdSel(); else noCompte">Aucune demande.</div>
  </ng-template>
  <ng-template #noCompte>
    <!-- <div class="empty">Aucun compte disponible.</div> -->
  </ng-template>
</div>

<!-- Modale création / édition -->
<div class="modal-backdrop" *ngIf="showModal()"></div>
<div class="modal" *ngIf="showModal()">
  <div class="modal-header">
    <div class="title">
      {{ editMode() ? 'Modifier la Demande' : 'Nouvelle Demande' }}
    </div>
    <button class="icon" (click)="closeModal()" aria-label="Fermer">
      <i class="ri-close-line"></i>
    </button>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()">
    <div class="modal-body">
      <label>Date de demande *</label>
      <input type="date" formControlName="dateDemande" placeholder="jj/mm/aaaa">

      <label>Nombre de pages *</label>
      <select formControlName="pages">
        <option [value]="10">10 pages</option>
        <option [value]="25">25 pages</option>
        <option [value]="50">50 pages</option>
      </select>

      <label>Motif (optionnel)</label>
      <input type="text" formControlName="motif" placeholder="Ex: renouvellement, perte, ...">
    </div>

    <div class="modal-footer">
      <button type="button" class="btn light" (click)="closeModal()">Annuler</button>
      <button type="submit"
              class="btn"
              [ngClass]="editMode() ? 'warning' : 'primary'"
              [disabled]="form.invalid || !compteIdSel()">
        {{ editMode() ? 'Enregistrer' : 'Créer' }}
      </button>
    </div>
  </form>
</div>

<div class="error" *ngIf="errorMsg()">{{ errorMsg() }}</div>
