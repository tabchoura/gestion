<!-- En-tête -->
<div class="card header">
  <div class="title">
    <i class="ri-booklet-line"></i>
    Mes Demandes de Chéquier
  </div>
  <button class="btn light" routerLink="/dashboardclient/comptes">
    <i class="ri-arrow-left-line"></i> Retour aux Comptes
  </button>
</div>

<!-- Sélecteur de compte : caché si on arrive avec /demandes/:compteId -->
<div class="card" *ngIf="!forceCompte()">
  <label>Choisir un compte bancaire</label>
  <select #acc (change)="onSelectCompte(acc.value)">
    <option value="">-- Sélectionner un compte --</option>
    <option *ngFor="let c of comptes" [value]="c.id" [selected]="c.id === compteIdSel()">
      {{ c.banque }} — {{ c.numeroCompte }} ({{ c.devise }})
    </option>
  </select>
</div>

<!-- Rappel du compte forcé (aucune arrow function ici) -->
<div class="card" *ngIf="forceCompte() && compteIdSel()">
  <div class="title small">
    Compte sélectionné :
    <b>{{ selectedBanque }} — {{ selectedNumero }}</b>
  </div>
</div>

<!-- Liste + Actions -->
<div *ngIf="compteIdSel()" class="card list">
  <div class="list-header">
    <div class="title small"><i class="ri-booklet-line"></i> Demandes du Compte</div>
  <button class="btn success"
          *ngIf="!forceCompte()"
          (click)="openModal()">
    <i class="ri-add-line"></i> Nouvelle Demande
  </button>  </div>

  <table class="table" *ngIf="demandes?.length; else empty">
    <thead>
      <tr>
        <th>Date Demande</th>
        <th>Pages</th>
        <th>Motif</th>
        <th>Statut</th>
        <th class="actions">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let d of demandes">
        <td>{{ d.dateDemande | date:'dd/MM/yyyy' }}</td>
        <td>{{ d.pages }}</td>
        <td>{{ d.motif || '—' }}</td>
        <td><span [class]="badgeClass(d.statut)">{{ d.statut.replace('_',' ') }}</span></td>
        <td class="actions">
          <button class="icon blue" title="Détails"><i class="ri-list-check"></i></button>
          <button class="icon dark" title="Annuler" *ngIf="d.statut==='EN_ATTENTE'" (click)="annuler(d)">
            <i class="ri-close-circle-line"></i>
          </button>
          <button class="icon danger" title="Supprimer" (click)="supprimer(d)">
            <i class="ri-delete-bin-6-line"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #empty>
    <div class="empty">Aucune demande pour ce compte.</div>
  </ng-template>
</div>

<div class="modal-backdrop" *ngIf="showModal()"></div>
<div class="modal" *ngIf="showModal()">
  <div class="modal-header">
    <div class="title">Nouvelle Demande</div>
    <button class="icon" (click)="closeModal()"><i class="ri-close-line"></i></button>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()">
    <div class="modal-body">
      <label>Date de demande *</label>
      <input type="date" formControlName="dateDemande" placeholder="jj/mm/aaaa">

      <label>Nombre de pages *</label>
      <select formControlName="pages">
        <option [value]="10">10 pages</option>
        <option [value]="25">25 pages</option>
        <option [value]="50">50 pages</option>
      </select>

      <label>Motif (optionnel)</label>
      <input type="text" formControlName="motif" placeholder="Ex: renouvellement, perte, ...">
    </div>

    <div class="modal-footer">
      <button type="button" class="btn light" (click)="closeModal()">Annuler</button>
      <button type="submit" class="btn primary" [disabled]="form.invalid">Créer</button>
    </div>
  </form>
</div>

<div class="error" *ngIf="errorMsg()">{{ errorMsg() }}</div>
