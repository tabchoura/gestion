<div class="card header">
  <div class="title">
    <i class="ri-time-line"></i>
    <ng-container [ngSwitch]="mode()">
      <span *ngSwitchCase="'me'">Mon Historique</span>
      <span *ngSwitchCase="'type'">Historique — {{ currentType() }}</span>
      <span *ngSwitchCase="'resource'">Historique — {{ currentType() }} #{{ currentId() }}</span>
    </ng-container>
  </div>

  <button class="btn light" (click)="back()">
    <i class="ri-arrow-left-line"></i> Retour
  </button>
</div>

<ng-container *ngIf="!loading(); else loadingTpl">
  <div class="card" *ngIf="error(); else okTpl">{{ error() }}</div>
  <ng-template #okTpl>
    <div class="card" *ngIf="!items().length">Aucun événement.</div>

    <div class="card table" *ngIf="items().length">
      <table>
        <thead>
          <tr>
            <th>Quand</th>
            <th>Action</th>
            <th>Type</th>
            <th>Ressource</th>
            <th>Message</th>
            <th>Détails</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let it of items()">
            <tr>
              <td>{{ it.creeLe | date:'short' }}</td>
              <td>{{ it.action }}</td>
              <td>{{ it.ressourceType }}</td>
              <td>
                <span *ngIf="it.ressourceId">#{{ it.ressourceId }}</span>
                <span *ngIf="it.ressourceLabel"> — {{ it.ressourceLabel }}</span>
              </td>
              <td>{{ it.message || '—' }}</td>
              <td>
                <button class="mini" (click)="toggleRow(it.id)" *ngIf="it.payloadJson">Voir</button>
              </td>
            </tr>
            <tr class="payload" *ngIf="isExpanded(it.id)">
              <td colspan="6"><pre>{{ it.payloadJson }}</pre></td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </ng-template>
</ng-container>

<ng-template #loadingTpl>
  <div class="card">Chargement…</div>
</ng-template>
