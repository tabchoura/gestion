<div class="card">
  <div class="head">
    <h1>Mon profil</h1>
    <button class="btn btn-ghost" type="button" (click)="toggleEdit()">
      {{ editMode() ? 'Annuler' : 'Modifier' }}
    </button>
  </div>

  <form class="profile-grid" [formGroup]="form" (ngSubmit)="save()">
    <label class="field"><span>Email</span><input formControlName="email" [readonly]="!editMode()"></label>
    <label class="field"><span>Nom</span><input formControlName="nom" [readonly]="!editMode()"></label>
    <label class="field"><span>Prénom</span><input formControlName="prenom" [readonly]="!editMode()"></label>
  <!-- ✅ Nouveau champ : Numéro CIN -->
    <label class="field">
      <span>Numéro CIN</span>
      <input formControlName="numCin" [readonly]="!editMode()" maxlength="8"
             [class.invalid]="editMode() && numCin?.touched && numCin?.invalid">
      <small class="error" *ngIf="editMode() && numCin?.touched && numCin?.hasError('required')">
        Numéro CIN requis.
      </small>
      <small class="error" *ngIf="editMode() && numCin?.touched && numCin?.hasError('pattern')">
        Le CIN doit contenir exactement 8 chiffres.
      </small>
    </label>

    <div class="actions" *ngIf="editMode()">
      <button class="btn btn-primary" type="submit" [disabled]="loading() || !editMode()">
        {{ loading() ? 'Enregistrement…' : 'Enregistrer' }}
      </button>
      <button class="btn btn-ghost" type="button" (click)="toggleEdit()" [disabled]="loading()">Annuler</button>
    </div>
  </form>

  <div *ngIf="msg()" class="server-success" style="margin-top:12px;">{{ msg() }}</div>
  <div *ngIf="err()" class="server-error" style="margin-top:12px;">{{ err() }}</div>
</div>
